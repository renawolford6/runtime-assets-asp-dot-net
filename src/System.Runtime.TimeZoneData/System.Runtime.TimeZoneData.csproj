<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TimeZoneDataVersion>2020d</TimeZoneDataVersion>
    <InputFolder>$(MSBuildProjectDirectory)/input</InputFolder>
    <OutputFolder>$(MSBuildProjectDirectory)/data</OutputFolder>
  </PropertyGroup>
  <ItemGroup>
    <Area Include="africa" />
    <Area Include="antarctica" />
    <Area Include="asia" />
    <Area Include="australasia" />
    <Area Include="etcetera" />
    <Area Include="europe" />
    <Area Include="northamerica" />
    <Area Include="southamerica" />
    <Area Include="backward" />
  </ItemGroup>
  <Target Name="CheckVersion">
    <DownloadFile
      SourceUrl="https://data.iana.org/time-zones/tzdb/version"
      DestinationFolder="$(InputFolder)">
      <Output TaskParameter="DownloadedFile"
      ItemName="VersionFile"/>
    </DownloadFile>
    <ReadLinesFromFile
      File="@(VersionFile)">
      <Output
        TaskParameter="Lines"
        ItemName="VersionLines"/>
    </ReadLinesFromFile>
    <Warning Text="TimeZoneDataVerson does not match https://data.iana.org/time-zones/tzdb/version" Condition="'@(VersionLines)' != '$(TimeZoneDataVersion)'" />
  </Target>
  <Target Name="UpdateData">
    <RemoveDir Directories="$(OutputFolder)" />
    <DownloadFile
      SourceUrl="https://data.iana.org/time-zones/tzdb-$(TimeZoneDataVersion)/%(Area.Identity)"
      DestinationFolder="$(InputFolder)">
    </DownloadFile>
    <DownloadFile
      SourceUrl="https://data.iana.org/time-zones/tzdb-$(TimeZoneDataVersion)/zone1970.tab"
      DestinationFolder="$(OutputFolder)"
      DestinationFileName="zone.tab">
    </DownloadFile>
  </Target>
  <Target Name="CompileTimeZoneData" AfterTargets="UpdateData">
    <Exec Command="zic -d $(OutputFolder) $(InputFolder)/%(Area.Identity)" />
    <RemoveDir Directories="$(InputFolder)" />
  </Target>
</Project>
